<specialTag xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://activiti.org/bpmn20" id="review-definitions">
    
	<sequenceFlow id="flowIn" sourceRef="parallelgateway1" targetRef="usertask3"></sequenceFlow>
	<userTask id="usertask" name="ff" activiti:assignee="${lawyer}" activiti:candidateUsers="candidate1,candidate2,candidate3" activiti:candidateGroups="group1,group2,group3" activiti:formKey="approving">
            <extensionElements>
        <activiti:taskListener event="complete" class="org.activiti.engine.impl.bpmn.listener.ScriptTaskListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:expression>
			appr = task.getVariableLocal('approved')
			if (appr != "unknown"){
	task.setVariable("orderApproved", appr)
}
</activiti:expression>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.activiti.engine.impl.bpmn.listener.ScriptTaskListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:expression>task.setVariableLocal("complete", "true")</activiti:expression>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.activiti.engine.impl.bpmn.listener.ScriptTaskListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:expression>import java.util.regex.Matcher
import java.util.regex.Pattern

maxNumberLength = 3
taskKey = task.getTaskDefinitionKey()
docVersion = task.getVariable("documentVersion")
pattern = "^" + taskKey + "[0-9]{3}|(?&lt;=[0-9])" + taskKey + "[0-9]{3}"
mtchr = docVersion =~ pattern

if (mtchr.size() &lt;= 0) {
       strNum = "000"
 docVersion+=taskKey+strNum
} else {
       strNum = mtchr[0][taskKey.length()..taskKey.length()+maxNumberLength-1]
}
num = strNum.toInteger()
newNum=num+10
if (approved == "true"){
 newNum=newNum.intdiv(10)*10+1
}
for (i=1; i&lt;=maxNumberLength; i++){
       if (newNum.intdiv(10**i)==0){
  strNewNum="0"*(maxNumberLength-i)+newNum.toString()
              break
       }
}
docVersion = docVersion.replaceAll(taskKey+strNum, taskKey+strNewNum)

task.setVariable("documentVersion", docVersion)</activiti:expression>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="create" class="org.activiti.engine.impl.bpmn.listener.ScriptTaskListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:expression>task.setVariableLocal("complete", "false")
task.setVariableLocal("approved", "unknown")</activiti:expression>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
	<sequenceFlow id="flowOut" sourceRef="usertask3" targetRef="parallelgateway2">
		      <extensionElements>
        <activiti:executionListener event="take" class="org.activiti.engine.impl.bpmn.listener.ScriptExecutionListener">
          <activiti:field name="language">
            <activiti:string><![CDATA[groovy]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:expression>query = execution.getEngineServices().getTaskService().createTaskQuery().processInstanceId(execution.getProcessInstanceId()).orderByTaskName().asc();
//execution.setVariableLocal("taskList", query.list())
orderAppr = execution.getVariable("orderApproved")
if (orderAppr == "false"){	
	for (taskItem in query.list()){
	
		if (taskItem.getVariableLocal("complete") != "true"){
			taskItem.setVariableLocal("approved", "unknown")
			execution.getEngineServices().getTaskService().complete(taskItem.getId())
		}
	}
}</activiti:expression>
          </activiti:field>
        </activiti:executionListener>
      </extensionElements>
	</sequenceFlow>
</specialTag>