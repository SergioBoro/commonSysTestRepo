<?xml version="1.0" encoding="UTF-8"?><?xml-stylesheet href="xsltforms/xsltforms.xsl" type="text/xsl"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xsd="http://www.w3.org/2001/XMLschema" xmlns:fs="http://www.curs.ru/ns/FormServer" xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<style type="text/css">
			body {
			    font-family: sans-serif;
			}
			div {
			    margin: 0px 0px 0px 0px;
			    padding: 0px;
			}
      td {
        vertical-align: top;
      }
			button.TabButton {
			    border: 0px;
			    background-color: transparent;
			    width: 100%;
			    height: 100%;
			}
      .baseTableInput .xforms-value {
          background-color: #ffffcc;
          border-bottom: 1px solid rgb(90, 139, 195); /*rgb(255,192,128);*/
          display: block;
          min-height: 17px;
          width: 100%;
          padding: 1px 0px 2px 2px;
      }
      div.baseTableInput2,
      .baseTableInput2 .xforms-value {
          background-color: #E5F2FF;
          border: 0 none;
          display: block;
          min-height: 21px;
          width: 100%;
          padding: 1px 0px 2px 2px;
      }
			.aid-button, 
			.aid-button
			button {
        width: 30px !important;
        height: 20px !important;
      }
		</style>
		<xf:model id="xformId_mainModel">
			<xf:instance id="xformId_mainInstance">
				<schema xmlns="">
					<sprav>
            <name>Тест</name>
            <prefix>Тест</prefix>
            <table_name>test</table_name>
					</sprav>
				</schema>
			</xf:instance>
      <xf:instance id="xformId_sprav">
				<schema xmlns="">
					<check>false</check>
				</schema>
			</xf:instance>

			<xf:bind>
        <!--xf:bind type="boolean" nodeset="instance('sprav')/check" /!-->
        <xf:bind calculate="if((instance('xformId_mainInstance')/sprav/name='') or (instance('xformId_mainInstance')/sprav/prefix='') or (instance('xformId_mainInstance')/sprav/table_name=''),           'Не все поля заполнены!','')" nodeset="instance('xformId_mainInstance')/error_message"></xf:bind>
			</xf:bind>

      <xf:submission id="xformId_check_sprav" method="post" instance="xformId_sprav" replace="instance" ref="instance('xformId_mainInstance')" action="secured/sqlTransform?proc=ssp.struct_sprav_check">
        <xf:action ev:event="xforms-submit-done">
          <!--xf:message>Сделано</xf:message!-->
          <xf:load resource="javascript:xforms.ready = false;xforms.refresh();xforms.ready = true;"></xf:load>
        </xf:action>
        <xf:action ev:event="xforms-submit-error">
          <xf:message>Ошибка при получении данных</xf:message>
        </xf:action>
      </xf:submission>
		</xf:model>
	</head>
	<body>
 	  <div style="width: 560px; float: left; clear: both;"> 
      <div class="group" style="width: 550px; height: 160px; float: left; clear: both; padding: 2px; margin: 0;">
        <div style="float: left; clear: both; margin-top: 5px;">
          <div class="cellHeader" style="height: 10px; width: 183px; float: left; clear: both; padding-right: 2px;">Название</div>
          <div class="cellHeader" style="height: 10px; width: 350px; float: left">Значение</div>
        </div>
        <div style="float: left; clear: both;">
          <table class="main2" cellspacing="1" cellpadding="0">
            <tr>
              <td style="width: 187px; font-weight: bold;">
                <div class="baseTableInput2">Название справочника</div>
              </td>
              <td style="width: 352px; padding-left: 2px;">
                <xf:input class="baseTableInput" ref="instance('xformId_mainInstance')/sprav/name"></xf:input>
              </td>
            </tr>
          </table>
          <table class="main2" cellspacing="1" cellpadding="0">
            <tr>
              <td style="width: 187px; font-weight: bold;">
                <div class="baseTableInput2">Тип справочника</div>
              </td>
              <td style="width: 352px; padding-left: 2px;">
                <xf:group ref="instance('xformId_mainInstance')/sprav[id=0]">
                  <xf:select1 class="baseTableInput" ref="instance('xformId_mainInstance')/sprav/type_id">
                    <xf:itemset nodeset="instance('xformId_mainInstance')/types/type">
                      <xf:label ref="@name"></xf:label>
                      <xf:value ref="@id"></xf:value>
                    </xf:itemset>
                  </xf:select1>
                </xf:group>
                <xf:group ref="instance('xformId_mainInstance')/sprav[id!=0]">
                  <xf:output class="baseTableInput2" value="instance('xformId_mainInstance')/types/type[@id=instance('xformId_mainInstance')/sprav/type_id]/@name"></xf:output>
                </xf:group>
              </td>
            </tr>
          </table>
          <table class="main2" cellspacing="1" cellpadding="0">
            <tr>
              <td style="width: 187px; font-weight: bold;">
                <div class="baseTableInput2">Префикс справочника</div>
              </td>
              <td style="width: 352px; padding-left: 2px;">
                <xf:group ref="instance('xformId_mainInstance')/sprav[id=0]">
                  <xf:input class="baseTableInput" ref="instance('xformId_mainInstance')/sprav/prefix"></xf:input>
                </xf:group>
                <xf:group ref="instance('xformId_mainInstance')/sprav[id!=0]">
                  <xf:output class="baseTableInput2" value="instance('xformId_mainInstance')/sprav/prefix"></xf:output>
                </xf:group>
              </td>
            </tr>
          </table>
          <table class="main2" cellspacing="1" cellpadding="0">
            <tr>
              <td style="width: 187px; font-weight: bold;">
                <div class="baseTableInput2">Название таблицы</div>
              </td>
              <td style="width: 352px; padding-left: 2px;">
                <xf:group ref="instance('xformId_mainInstance')/sprav[id=0]">
                  <xf:input class="baseTableInput" ref="instance('xformId_mainInstance')/sprav/table_name"></xf:input>
                </xf:group>
                <xf:group ref="instance('xformId_mainInstance')/sprav[id!=0]">
                  <xf:output class="baseTableInput2" value="instance('xformId_mainInstance')/sprav/table_name"></xf:output>
                </xf:group>
              </td>
            </tr>
          </table>
          <table class="main2" cellspacing="1" cellpadding="0">
            <tr>
              <td style="width: 187px; font-weight: bold;">
                <div class="baseTableInput2">Папка</div>
              </td>
              <td style="width: 352px; padding-left: 2px;">
                <xf:select1 class="baseTableInput" ref="instance('xformId_mainInstance')/sprav/folder_id">
                  <xf:itemset nodeset="instance('xformId_mainInstance')/folders/folder">
                    <xf:label ref="@name"></xf:label>
                    <xf:value ref="@id"></xf:value>
                  </xf:itemset>
                </xf:select1>
              </td>
            </tr>
          </table>
          <!--table class="main2" cellspacing="1" cellpadding="0">
            <tr>
              <td style="width: 187px; font-weight: bold;">
                <div class="baseTableInput2">Скрипт</div>
              </td>
              <td style="width: 352px; padding-left: 2px;">
                <xf:textarea class="baseTableInput" rows="7" ref="/schema/sprav/sql_text"/>
              </td>
            </tr>
          </table-->
        </div>
      </div>
    </div>
		<div style="float: left; width: 560px; clear: both;">
      <div style="float: right; margin: 5px 0; padding: 0;">
        <div class="newbutton" style="width: 130px; margin: 0; padding-left: 10px; float: left;">
          <xf:trigger class="blue">
            <xf:label>ОК</xf:label>
            <xf:action ev:event="DOMActivate">
              <xf:action if="instance('xformId_mainInstance')/error_message!=''">
                <xf:message ref="instance('xformId_mainInstance')/error_message"></xf:message>
              </xf:action>
              <xf:action if="instance('xformId_mainInstance')/error_message=''">
                <xf:send submission="xformId_check_sprav"></xf:send>
                <xf:action if="instance('xformId_sprav')/check='true'">
                  <xf:load resource="javascript:gwtXFormSave('xformId','1',  Writer.toString(getSubformInstanceDocument('xformId_mainModel', 'xformId_mainInstance')))"></xf:load>
                </xf:action>
                <xf:action if="instance('xformId_sprav')/check!='true'">
                  <xf:message ref="instance('xformId_sprav')/check"></xf:message>
                </xf:action>
              </xf:action>
            </xf:action>
          </xf:trigger>
        </div>
        <div class="newbutton" style="width: 130px; margin: 0; padding-left: 10px; float: left;">
          <xf:trigger class="blue">
            <xf:label>Отмена</xf:label>
            <xf:action ev:event="DOMActivate">
              <xf:load resource="javascript:gwtXFormFilter('xformId','1', null)"></xf:load>
            </xf:action>
          </xf:trigger>
        </div>
      </div>
		</div>
	</body>
</html>