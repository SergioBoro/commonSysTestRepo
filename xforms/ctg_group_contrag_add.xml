<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="xsltforms/xsltforms.xsl" type="text/xsl"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xsd="http://www.w3.org/2001/XMLschema" xmlns:fs="http://www.curs.ru/ns/FormServer"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head>
		<style type="text/css">
			div.ScrollPanel1 {
        margin: 1px;
        padding: 0px;
        height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
			}
			div.ScrollPanel2 {
        margin: 1px;
        padding: 0px;
        height: 313px;
        overflow-y: auto;
        overflow-x: hidden;
			}
			div.ScrollPanel3 {
        margin: 1px;
        padding: 0px;
        height: 313px;
        overflow-y: auto;
        overflow-x: hidden;
			}
			.aid-button,
			.aid-button button,
      div#group .xforms-control button
			{
        width: 30px !important;
        height: 20px !important;
			}
      .TabButton00
      {
        height: 30px !important;
      }
      .dateInput
			.xforms-value {
        width: 100px !important;
        border: 0px;
        padding: 2px 0px 2px 0px;
        background-color: #E5F2FF;
        margin: 6px 0px 0px 0px;
        min-height: 13px;
			}
      </style>
		<xf:model id="xformId_mainModel">
			<xf:instance id="xformId_mainInstance">
				<schema xmlns="">
          <info>
            <group id="0" allowlinks="0" allowgroups="1"/>
          </info>
          <contrags/>
          <links/>
				</schema>
			</xf:instance>
			<xf:instance id="contragTemplate">
				<schema xmlns="">
					<contrag id="" name="" startdate="" link=""/>
				</schema>
			</xf:instance>
			<xf:instance id="quot">
				<schema xmlns="">&quot;</schema>
			</xf:instance>
      <xf:instance id="count">
        <count/>
      </xf:instance>
			<xf:bind>
        <xf:bind nodeset="instance('xformId_mainInstance')/contrags/contrag/@startdate" type="date"/>
			</xf:bind>
      <xf:action ev:event="xforms-ready">
        <xf:setvalue ref="instance('contragTemplate')/contrag/@link" value="instance('xformId_mainInstance')/deflink"/>
      </xf:action>
		</xf:model>
	</head>
	<body>
    <!--<xf:output value="serialize(instance('xformId_mainInstance'))"/>-->
    <div style="width: 590px; float: left; padding: 0; margin: 0;">
      <div style="width: 590px; min-height: 0px; margin: 5px 0; float: left; clear: both;">
        <div style="float: left;">
          <label for="companies" style="display: left;">Клиенты</label>
        </div>
        <div class="newbutton" style="width: 130px; float: right; padding: 3px 0 0 0; margin: 0 0 0 5px;">
          <xf:trigger class="blue">
            <xf:label>Удалить всё</xf:label>
            <xf:action ev:event="DOMActivate">
              <xf:delete nodeset="instance('xformId_mainInstance')/contrags/*"/>
            </xf:action>
          </xf:trigger>
        </div>
        <div class="newbutton" style="width: 130px; float: right; padding: 3px 0 0 0;">
          <div class="blue" style="margin: 0;padding: 0;">
              <xf:multiselector 
                buttonLabel       = "Добавить"  
                procListAndCount  = "'ctg.selector.selectors.groupContragMultiSelector.celesta'" 
                generalFilters    = "['XPath(instance(quot(xformId_mainInstance))/info/group/@id)', 'XPath(instance(quot(xformId_mainInstance))/info/group/@allowgroups)']"
                currentValue      = "''"
                windowCaption     = "'Выбор клиентов'"
                needClear         = "true"
                needInitSelection = "true"
                xpathRoot         = "'XPath(instance(quot(xformId_mainInstance))/contrags)'"
                xpathMapping      = "{'XPath(instance(quot(contragTemplate))/contrag)':{'id': '@id','name':'@name','startdate':'@startdate'}}"
              />
          </div>         
        </div>
      </div>
      <div style="float:left; width: 580px; clear: both;" class="group " id="companies">
        <div class="ScrollPanel1" style="width: 550px; padding: 2px; float: left; clear: both;">
          <xf:repeat id="ContragRow" nodeset="instance('xformId_mainInstance')/contrags/contrag">
            <div style="width: 350px; padding: 2px 5px 0 0; float: left; clear:both;">
              <xf:input class="baseInput" ref="@name"/>
            </div>
            <div class="newbutton" style="width: 130px; padding: 0; margin: 0; float: left;">
              <xf:input class="dateInput blue" ref="@startdate" style="width: 100px;"/>
            </div>         
            <div class="newbutton" style="width: 30px; padding: 6px 2px 2px 2px; float: left;">
              <xf:trigger class="aid-button blue">
                <xf:label>-</xf:label>
                <xf:action ev:event="DOMActivate">
                  <xf:delete nodeset="instance('xformId_mainInstance')/contrags/contrag[index('ContragRow')]"/>
                </xf:action>
              </xf:trigger>
            </div>
          </xf:repeat>
        </div>
      </div>
    </div>
		<div style="float: left; width: 590px; clear: both;">
      <div style="float: right; margin: 5px 0; padding: 0;">
        <div class="newbutton" style="width: 130px; margin: 0; padding-left: 10px; float: left;">
          <xf:trigger class="blue">
            <xf:label>ОК</xf:label>
            <xf:action ev:event="DOMActivate">
              <xf:load resource="javascript:gwtXFormSave('xformId','1',  Writer.toString(getSubformInstanceDocument('xformId_mainModel', 'xformId_mainInstance')))"></xf:load>
            </xf:action>
          </xf:trigger>
        </div>
        <div class="newbutton" style="width: 130px; margin: 0; padding-left: 10px; float: left;">
          <xf:trigger class="blue">
            <xf:label>Отмена</xf:label>
            <xf:action ev:event="DOMActivate">
              <xf:load resource="javascript:gwtXFormFilter('xformId','1', null)"/>
            </xf:action>
          </xf:trigger>
        </div>
      </div>
		</div>
    <!--xf:output value="serialize(instance('xformId_mainInstance'))"/-->
	</body>
</html>
